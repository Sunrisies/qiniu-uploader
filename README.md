# 完美整合：使用七牛云作为Typora的自动图床（Windows版）与本地备份功能

作为一名Markdown爱好者，Typora的简洁与高效无疑极大地提升了我们的写作体验。然而，手动管理文章中的图片并逐个上传到图床是一个繁琐且容易出错的过程。本文将指导Windows用户如何通过一个简单的脚本和配置，将七牛云对象存储变为Typora的专属自动图床，实现"复制即上传，粘贴即链接"的流畅体验，同时新增本地备份功能确保数据安全。

本教程分为四个核心步骤，完全针对Windows系统优化。

## 第一步：获取并放置上传程序

您需要一个能够与七牛云API和Typora交互的上传工具。这里我们使用一个专门为Windows编译的上传工具。

1. **获取程序**：
   - 从可靠的来源获取Windows版的七牛云上传工具（例如 `qiniu-uploader.exe`）
   - 确保下载的工具是最新版本，以兼容当前的七牛云API

2. **放置程序**：
   - 在您的电脑上创建一个专门的文件夹来存放该程序和配置文件，例如 `D:\Typora-Qiniu\`
   - 将下载好的上传程序（如 `qiniu-uploader.exe`）放入此文件夹中

## 第二步：创建与编辑配置文件 (config.json)

在上传程序所在的同一文件夹内，我们需要创建一个名为 `config.json` 的文本文件，用于告知程序如何连接您的七牛云账户以及设置本地备份。

1. **创建配置文件**：
   - 在 `D:\Typora-Qiniu\` 文件夹中，右键新建一个文本文档
   - 将其重命名为 `config.json`（如果系统隐藏了扩展名，请先取消隐藏：查看 → 勾选"文件扩展名"）

2. **编辑配置文件**：
   - 使用记事本或其他文本编辑器打开 `config.json` 文件
   - 将以下JSON配置内容复制进去，并替换其中的占位符为您的实际信息

```json
{
    "access_key": "这里替换成您的七牛云AK（Access Key）",
    "secret_key": "这里替换成您的七牛云SK（Secret Key）",
    "bucket_name": "这里替换成您的空间名称（Bucket Name）",
    "base_url": "这里替换成您的域名，例如：http://img.example.com",
    "base_dir": "D:\\Typora-Qiniu\\LocalImages"
}
```

**参数详解与获取方式**：
- `access_key` & `secret_key`：这是您七牛云账户的密钥，相当于账号密码，请务必妥善保管。
  - 获取路径：登录七牛云后台 → 个人中心 → [密钥管理](https://portal.qiniu.com/user/key) → 查看AK/SK
- `bucket_name`：您创建的存储空间的名字
- `base_url`：您绑定到存储空间的测试域名或自定义域名（推荐），注意要以 `http://` 或 `https://` 开头。上传成功后，图片的链接将是 `{base_url}/{图片文件名}`
- `base_dir`：**新增功能** - 本地存储路径。程序会在上传图片到七牛云的同时，在本地保留一份备份。请确保此路径存在且有写入权限（例如：`D:\\Typora-Qiniu\\LocalImages`）

保存并关闭 `config.json` 文件。

## 第三步：创建本地备份目录

根据您在配置文件中设置的 `base_dir` 路径，创建本地备份文件夹：

1. 打开文件资源管理器，导航到您想要创建备份目录的位置
2. 右键 → 新建 → 文件夹
3. 命名为与配置中 `base_dir` 一致的名称（例如：`LocalImages`）
4. 确保此目录有写入权限（通常默认就有）

## 第四步：配置Typora

最后一步是告诉Typora使用我们刚刚准备好的上传工具。

1. **打开Typora设置**：
   - 启动Typora，点击顶部菜单栏的 `文件` → `偏好设置`

2. **切换到「图像」设置页**：
   - 在左侧设置列表中，找到并点击 **「图像」**

3. **进行核心配置**：
   - 在「上传服务」板块，进行如下设置：
     - **上传服务**：选择 `Custom Command`
     - **命令**：填写上传程序的完整路径。例如：`D:\Typora-Qiniu\qiniu-uploader.exe`
   - 勾选「对本地位置的图片应用上述规则」
   - 勾选「对网络位置的图片应用上述规则」
   - 在「插入时」选择「上传图片」

4. **验证配置**：
   - 点击「验证图片上传选项」按钮
   - Typora 会尝试上传一张测试图片。如果所有配置都正确，您会看到 **"验证成功"** 的提示，并且会显示一张通过七牛云链接加载的图片
   - 同时检查您设置的本地备份目录（如 `D:\Typora-Qiniu\LocalImages`）中是否也保存了测试图片的副本

## 开始使用！

现在，一切就已配置完毕。您可以享受行云流水般的写作体验了：
- 在Typora中，直接将剪贴板中的图片（`Ctrl+V`）粘贴到文档中
- 或者拖动本地图片到文档中
- Typora会自动调用后台的上传程序，将图片上传至您配置的七牛云空间，并自动将文档中的图片地址替换为高效的云端URL
- **同时**，程序会在您指定的本地目录中保留一份图片备份，确保数据安全

## 常见问题排查（Windows特有）

- **验证失败**：
  - **路径错误**：确保「命令」中的程序路径使用反斜杠且完全正确，例如 `D:\Typora-Qiniu\qiniu-uploader.exe`
  - **安全软件拦截**：检查您的杀毒软件或Windows Defender是否误报了上传工具，如有需要请添加例外
  - **配置信息错误**：仔细检查 `config.json` 文件中的 AK、SK、Bucket名称和域名是否填写正确
  - **本地目录权限**：确保 `base_dir` 指定的目录存在且有写入权限

- **上传成功但图片不显示**：
  - 检查 `base_url` 域名是否已正确备案并绑定到存储空间，并且网络可以正常访问

- **本地备份未生成**：
  - 检查 `base_dir` 路径是否正确且存在
  - 确认程序有该目录的写入权限
  - 检查路径中是否使用了双反斜杠 `\\` 进行转义

通过以上四步，您就成功为Windows系统下的Typora搭建了一个专业、高效的自动化写作工作流，同时享有云端访问速度和本地数据安全的双重保障，让您能够更专注于内容创作本身。